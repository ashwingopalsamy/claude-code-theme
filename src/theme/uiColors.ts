import type { WorkbenchColors, ThemeContext } from '../types';
import { opacity, transparent } from './utilities';

export function getUiColors(context: ThemeContext): WorkbenchColors {
  const { palette, ansiColors, variant } = context;
  const isDark = palette.type === 'dark';
  const isHighContrast = variant.includes('high-contrast');
  const isBrandVariant = variant.endsWith('brand');
  const selectionAlpha = isDark ? 0.26 : 0.18;
  const softSelectionAlpha = isDark ? 0.16 : 0.1;
  const lineAlpha = isDark ? 0.12 : 0.08;
  const subtleShadow = isDark ? '#00000066' : '#0000001f';
  const brandPrimary = palette.brand.primary;
  const brandSurface = isDark ? '#AE4E30' : brandPrimary;
  const brandSurfaceHover = isDark ? '#9E452F' : '#BF5A39';
  const brandSurfacePressed = isDark ? '#8F3C2D' : '#AE4E30';
  const brandOnPrimary = isDark ? palette.brand.neutral.paper : palette.brand.neutral.ink;
  const statusBarBackground = isBrandVariant ? brandSurface : palette.backgroundMuted;
  const statusBarForeground = isBrandVariant ? brandOnPrimary : palette.foregroundMuted;
  const statusBarBorder = isBrandVariant ? brandSurfacePressed : palette.border;
  const statusBarItemHoverBackground = isBrandVariant
    ? opacity(brandOnPrimary, isDark ? 0.18 : 0.14)
    : opacity(palette.accent, softSelectionAlpha);
  const primaryButtonBackground = isBrandVariant ? brandSurface : palette.accent;
  const primaryButtonHoverBackground = isBrandVariant ? brandSurfaceHover : palette.accentHover;
  const primaryButtonForeground = isBrandVariant ? brandOnPrimary : palette.background;

  const bracketColors = [
    palette.syntax.keyword,
    palette.syntax.function,
    palette.syntax.number,
    palette.syntax.string,
    palette.syntax.namespace,
    palette.syntax.constant,
  ];

  return {
    foreground: palette.foreground,
    disabledForeground: palette.foregroundSubtle,
    descriptionForeground: palette.foregroundMuted,
    errorForeground: palette.status.error,
    'icon.foreground': palette.foregroundMuted,
    focusBorder: palette.accent,
    contrastBorder: isHighContrast ? palette.borderStrong : transparent,
    contrastActiveBorder: isHighContrast ? palette.accent : transparent,
    'widget.shadow': isDark ? '#00000080' : '#00000020',
    'widget.border': palette.border,
    'selection.background': opacity(palette.accent, softSelectionAlpha),
    'sash.hoverBorder': palette.accent,

    'window.activeBorder': transparent,
    'window.inactiveBorder': transparent,

    'titleBar.activeBackground': palette.backgroundAlt,
    'titleBar.activeForeground': palette.foregroundMuted,
    'titleBar.inactiveBackground': palette.backgroundAlt,
    'titleBar.inactiveForeground': palette.foregroundSubtle,
    'titleBar.border': palette.border,

    'activityBar.background': palette.backgroundAlt,
    'activityBar.foreground': palette.foreground,
    'activityBar.inactiveForeground': palette.foregroundSubtle,
    'activityBar.activeBorder': palette.accent,
    'activityBar.activeFocusBorder': palette.accent,
    'activityBar.activeBackground': opacity(palette.accent, softSelectionAlpha),
    'activityBar.border': palette.border,
    'activityBarBadge.background': isBrandVariant ? brandSurface : palette.accent,
    'activityBarBadge.foreground': isBrandVariant ? brandOnPrimary : palette.background,
    'activityBarTop.foreground': palette.foreground,
    'activityBarTop.activeBorder': palette.accent,
    'activityBarTop.dropBorder': palette.accent,

    'sideBar.background': palette.backgroundAlt,
    'sideBar.foreground': palette.foregroundMuted,
    'sideBar.border': palette.border,
    'sideBarSectionHeader.background': palette.backgroundAlt,
    'sideBarSectionHeader.foreground': palette.foreground,
    'sideBarSectionHeader.border': palette.border,
    'sideBarTitle.foreground': palette.foregroundMuted,
    'sideBar.dropBackground': opacity(palette.accent, lineAlpha),

    'editorGroupHeader.tabsBackground': palette.backgroundAlt,
    'editorGroupHeader.tabsBorder': palette.border,
    'editorGroupHeader.noTabsBackground': palette.backgroundAlt,
    'editorGroup.border': palette.border,
    'editorGroup.dropBackground': opacity(palette.accent, softSelectionAlpha),

    'tab.activeBackground': palette.background,
    'tab.activeForeground': palette.foreground,
    'tab.activeBorder': palette.accent,
    'tab.activeModifiedBorder': palette.git.modified,
    'tab.activeBorderTop': palette.accent,
    'tab.inactiveBackground': palette.backgroundAlt,
    'tab.inactiveForeground': palette.foregroundSubtle,
    'tab.inactiveModifiedBorder': palette.git.modified,
    'tab.border': palette.border,
    'tab.lastPinnedBorder': palette.border,
    'tab.selectedForeground': palette.foreground,
    'tab.selectedBorderTop': palette.accent,
    'tab.unfocusedActiveBorder': opacity(palette.accent, 0.5),
    'tab.unfocusedActiveBorderTop': opacity(palette.accent, 0.5),
    'tab.unfocusedInactiveModifiedBorder': opacity(palette.git.modified, 0.6),

    'editor.background': palette.background,
    'editor.foreground': palette.foreground,
    'editorLineNumber.foreground': palette.foregroundSubtle,
    'editorLineNumber.activeForeground': palette.foregroundMuted,
    'editorLineNumber.dimmedForeground': opacity(palette.foregroundSubtle, 0.65),
    'editorCursor.foreground': palette.accent,
    'editorMultiCursor.primary.foreground': palette.background,
    'editorMultiCursor.primary.background': palette.accent,
    'editorMultiCursor.secondary.foreground': palette.background,
    'editorMultiCursor.secondary.background': palette.syntax.namespace,
    'editor.selectionBackground': opacity(palette.accent, selectionAlpha),
    'editor.selectionForeground': palette.foreground,
    'editor.inactiveSelectionBackground': opacity(palette.accent, softSelectionAlpha),
    'editor.selectionHighlightBackground': opacity(palette.accent, softSelectionAlpha),
    'editor.selectionHighlightBorder': opacity(palette.accent, 0.7),
    'editor.wordHighlightBackground': opacity(palette.accent, softSelectionAlpha),
    'editor.wordHighlightStrongBackground': opacity(palette.accent, selectionAlpha),
    'editor.findMatchBackground': opacity(palette.syntax.number, isDark ? 0.26 : 0.22),
    'editor.findMatchBorder': palette.syntax.number,
    'editor.findMatchHighlightBackground': opacity(palette.syntax.number, softSelectionAlpha),
    'editor.findMatchHighlightBorder': opacity(palette.syntax.number, 0.7),
    'editor.findRangeHighlightBackground': opacity(palette.syntax.number, lineAlpha),
    'editor.lineHighlightBackground': opacity(palette.accent, lineAlpha),
    'editor.lineHighlightBorder': transparent,
    'editor.rangeHighlightBackground': opacity(palette.accent, lineAlpha),
    'editor.hoverHighlightBackground': opacity(palette.accent, lineAlpha),
    'editor.stackFrameHighlightBackground': opacity(palette.status.warning, lineAlpha),
    'editor.focusedStackFrameHighlightBackground': opacity(palette.status.warning, softSelectionAlpha),
    'editor.linkedEditingBackground': opacity(palette.syntax.namespace, lineAlpha),
    'editorUnicodeHighlight.background': opacity(palette.status.warning, lineAlpha),
    'editorUnicodeHighlight.border': palette.status.warning,
    'editorWhitespace.foreground': opacity(palette.foregroundSubtle, 0.55),
    'editorIndentGuide.background1': opacity(palette.borderStrong, 0.35),
    'editorIndentGuide.activeBackground1': opacity(palette.borderStrong, 0.65),
    'editorRuler.foreground': opacity(palette.borderStrong, 0.4),

    'editorBracketMatch.background': opacity(palette.accent, softSelectionAlpha),
    'editorBracketMatch.border': palette.accent,
    'editorBracketHighlight.foreground1': bracketColors[0],
    'editorBracketHighlight.foreground2': bracketColors[1],
    'editorBracketHighlight.foreground3': bracketColors[2],
    'editorBracketHighlight.foreground4': bracketColors[3],
    'editorBracketHighlight.foreground5': bracketColors[4],
    'editorBracketHighlight.foreground6': bracketColors[5],
    'editorBracketHighlight.unexpectedBracket.foreground': palette.status.error,

    'editorGutter.background': palette.background,
    'editorGutter.addedBackground': palette.git.added,
    'editorGutter.modifiedBackground': palette.git.modified,
    'editorGutter.deletedBackground': palette.git.deleted,
    'editorGutter.foldingControlForeground': palette.foregroundSubtle,

    'editorHoverWidget.background': palette.surface,
    'editorHoverWidget.foreground': palette.foreground,
    'editorHoverWidget.border': palette.border,
    'editorHoverWidget.statusBarBackground': palette.backgroundMuted,

    'editorWidget.background': palette.surface,
    'editorWidget.foreground': palette.foreground,
    'editorWidget.border': palette.border,
    'editorWidget.resizeBorder': palette.accent,

    'editorSuggestWidget.background': palette.surface,
    'editorSuggestWidget.foreground': palette.foreground,
    'editorSuggestWidget.border': palette.border,
    'editorSuggestWidget.highlightForeground': palette.accent,
    'editorSuggestWidget.selectedBackground': opacity(palette.accent, softSelectionAlpha),
    'editorSuggestWidget.selectedForeground': palette.foreground,

    'editorError.foreground': palette.status.error,
    'editorWarning.foreground': palette.status.warning,
    'editorInfo.foreground': palette.status.info,
    'editorHint.foreground': palette.status.success,

    'diffEditor.insertedTextBackground': opacity(palette.status.success, softSelectionAlpha),
    'diffEditor.insertedLineBackground': opacity(palette.status.success, lineAlpha),
    'diffEditor.removedTextBackground': opacity(palette.status.error, softSelectionAlpha),
    'diffEditor.removedLineBackground': opacity(palette.status.error, lineAlpha),
    'diffEditor.diagonalFill': opacity(palette.foregroundSubtle, 0.15),

    'peekView.border': palette.borderStrong,
    'peekViewEditor.background': palette.background,
    'peekViewEditorGutter.background': palette.backgroundAlt,
    'peekViewEditor.matchHighlightBackground': opacity(palette.syntax.number, lineAlpha),
    'peekViewEditor.matchHighlightBorder': opacity(palette.syntax.number, 0.75),
    'peekViewResult.background': palette.backgroundAlt,
    'peekViewResult.matchHighlightBackground': opacity(palette.syntax.number, softSelectionAlpha),
    'peekViewResult.selectionBackground': opacity(palette.accent, softSelectionAlpha),
    'peekViewResult.selectionForeground': palette.foreground,
    'peekViewTitle.background': palette.backgroundMuted,
    'peekViewTitleDescription.foreground': palette.foregroundMuted,
    'peekViewTitleLabel.foreground': palette.foreground,

    'panel.background': palette.backgroundAlt,
    'panel.border': palette.border,
    'panelTitle.activeForeground': palette.foreground,
    'panelTitle.inactiveForeground': palette.foregroundSubtle,
    'panelTitle.activeBorder': palette.accent,
    'panelInput.border': palette.border,
    'panel.dropBorder': palette.accent,
    'panelSection.border': palette.border,
    'panelSection.dropBackground': opacity(palette.accent, lineAlpha),
    'panelSectionHeader.background': palette.backgroundAlt,

    'statusBar.background': statusBarBackground,
    'statusBar.foreground': statusBarForeground,
    'statusBar.border': statusBarBorder,
    'statusBar.debuggingBackground': palette.syntax.number,
    'statusBar.debuggingForeground': palette.background,
    'statusBar.noFolderBackground': statusBarBackground,
    'statusBarItem.hoverBackground': statusBarItemHoverBackground,
    'statusBarItem.prominentBackground': opacity(palette.accent, softSelectionAlpha),
    'statusBarItem.prominentHoverBackground': opacity(palette.accent, selectionAlpha),
    'statusBarItem.remoteBackground': isBrandVariant ? (isDark ? brandSurfacePressed : brandSurface) : palette.accent,
    'statusBarItem.remoteForeground': isBrandVariant ? brandOnPrimary : palette.background,
    'statusBarItem.errorBackground': palette.status.error,
    'statusBarItem.warningBackground': palette.status.warning,
    'statusBar.focusBorder': palette.accent,

    'input.background': palette.surface,
    'input.foreground': palette.foreground,
    'input.border': palette.border,
    'input.placeholderForeground': palette.foregroundSubtle,

    'inputOption.activeBackground': opacity(palette.accent, softSelectionAlpha),
    'inputOption.activeBorder': palette.accent,
    'inputOption.activeForeground': palette.foreground,
    'inputOption.hoverBackground': opacity(palette.accent, lineAlpha),

    'inputValidation.errorBorder': palette.status.error,
    'inputValidation.errorBackground': opacity(palette.status.error, lineAlpha),
    'inputValidation.errorForeground': palette.status.error,
    'inputValidation.warningBorder': palette.status.warning,
    'inputValidation.warningBackground': opacity(palette.status.warning, lineAlpha),
    'inputValidation.warningForeground': palette.status.warning,
    'inputValidation.infoBorder': palette.status.info,
    'inputValidation.infoBackground': opacity(palette.status.info, lineAlpha),
    'inputValidation.infoForeground': palette.status.info,

    'button.background': primaryButtonBackground,
    'button.foreground': primaryButtonForeground,
    'button.border': opacity(palette.borderStrong, 0.75),
    'button.hoverBackground': primaryButtonHoverBackground,
    'button.secondaryBackground': palette.backgroundMuted,
    'button.secondaryForeground': palette.foreground,
    'button.secondaryBorder': palette.border,
    'button.secondaryHoverBackground': palette.surfaceHover,
    'checkbox.background': palette.surface,
    'checkbox.foreground': palette.foreground,
    'checkbox.border': palette.border,
    'radio.activeForeground': palette.accent,

    'dropdown.background': palette.surface,
    'dropdown.foreground': palette.foreground,
    'dropdown.border': palette.border,
    'dropdown.listBackground': palette.surface,

    'list.activeSelectionBackground': opacity(palette.accent, softSelectionAlpha),
    'list.activeSelectionForeground': palette.foreground,
    'list.hoverBackground': opacity(palette.accent, lineAlpha),
    'list.hoverForeground': palette.foreground,
    'list.focusBackground': opacity(palette.accent, softSelectionAlpha),
    'list.focusForeground': palette.foreground,
    'list.inactiveSelectionBackground': opacity(palette.accent, lineAlpha),
    'list.inactiveSelectionForeground': palette.foreground,
    'list.activeSelectionIconForeground': palette.accent,
    'list.inactiveSelectionIconForeground': palette.accent,
    'list.focusOutline': palette.accent,
    'list.inactiveFocusOutline': opacity(palette.accent, 0.65),
    'list.focusAndSelectionOutline': palette.accent,
    'list.dropBackground': opacity(palette.accent, softSelectionAlpha),
    'list.filterMatchBackground': opacity(palette.syntax.number, lineAlpha),
    'list.filterMatchBorder': palette.syntax.number,
    'list.highlightForeground': palette.accent,
    'list.errorForeground': palette.status.error,
    'list.warningForeground': palette.status.warning,

    'menu.background': palette.surface,
    'menu.foreground': palette.foreground,
    'menu.selectionBackground': opacity(palette.accent, softSelectionAlpha),
    'menu.selectionForeground': palette.foreground,
    'menu.selectionBorder': opacity(palette.accent, 0.7),
    'menu.separatorBackground': palette.border,

    'commandCenter.background': opacity(palette.accent, lineAlpha),
    'commandCenter.foreground': palette.foreground,
    'commandCenter.activeBackground': opacity(palette.accent, softSelectionAlpha),
    'commandCenter.border': palette.border,
    'commandCenter.activeBorder': palette.accent,

    'notificationCenterHeader.background': palette.backgroundMuted,
    'notificationCenterHeader.foreground': palette.foreground,
    'notificationToast.background': palette.surface,
    'notifications.foreground': palette.foreground,
    'notifications.background': palette.surface,
    'notifications.border': palette.border,
    'notificationLink.foreground': palette.accent,
    'notificationsErrorIcon.foreground': palette.status.error,
    'notificationsWarningIcon.foreground': palette.status.warning,
    'notificationsInfoIcon.foreground': palette.status.info,

    'badge.background': palette.backgroundMuted,
    'badge.foreground': palette.foreground,

    'progressBar.background': isBrandVariant ? brandSurface : palette.accent,

    'minimap.background': palette.background,
    'minimap.findMatchHighlight': palette.syntax.number,
    'minimap.selectionHighlight': palette.accent,
    'minimap.errorHighlight': palette.status.error,
    'minimap.warningHighlight': palette.status.warning,
    'minimapSlider.background': opacity(palette.accent, lineAlpha),
    'minimapSlider.hoverBackground': opacity(palette.accent, softSelectionAlpha),
    'minimapSlider.activeBackground': opacity(palette.accent, selectionAlpha),

    'scrollbarSlider.background': opacity(palette.foregroundSubtle, 0.22),
    'scrollbarSlider.hoverBackground': opacity(palette.foregroundMuted, 0.34),
    'scrollbarSlider.activeBackground': opacity(palette.foregroundMuted, 0.48),
    'scrollbar.background': palette.background,
    'scrollbar.shadow': subtleShadow,

    'editorOverviewRuler.addedForeground': opacity(palette.git.added, 0.85),
    'editorOverviewRuler.modifiedForeground': opacity(palette.git.modified, 0.85),
    'editorOverviewRuler.deletedForeground': opacity(palette.git.deleted, 0.85),
    'editorOverviewRuler.errorForeground': opacity(palette.status.error, 0.85),
    'editorOverviewRuler.warningForeground': opacity(palette.status.warning, 0.85),
    'editorOverviewRuler.infoForeground': opacity(palette.status.info, 0.85),
    'editorOverviewRuler.findMatchForeground': opacity(palette.syntax.number, 0.9),
    'editorOverviewRuler.bracketMatchForeground': opacity(palette.accent, 0.85),

    'problemsErrorIcon.foreground': palette.status.error,
    'problemsWarningIcon.foreground': palette.status.warning,
    'problemsInfoIcon.foreground': palette.status.info,

    'gitDecoration.addedResourceForeground': palette.git.added,
    'gitDecoration.modifiedResourceForeground': palette.git.modified,
    'gitDecoration.deletedResourceForeground': palette.git.deleted,
    'gitDecoration.untrackedResourceForeground': palette.git.added,
    'gitDecoration.ignoredResourceForeground': palette.foregroundSubtle,
    'gitDecoration.conflictingResourceForeground': palette.status.warning,

    'terminal.background': palette.background,
    'terminal.foreground': palette.foreground,
    'terminal.border': palette.border,
    'terminalCursor.foreground': palette.accent,
    'terminalCursor.background': palette.background,
    'terminal.selectionBackground': opacity(palette.accent, selectionAlpha),
    'terminal.selectionForeground': palette.foreground,
    'terminal.dropBackground': opacity(palette.accent, softSelectionAlpha),
    'terminal.tab.activeBorder': palette.accent,
    'terminalCommandDecoration.defaultBackground': opacity(palette.syntax.namespace, 0.5),
    'terminalCommandDecoration.successBackground': opacity(palette.status.success, 0.55),
    'terminalCommandDecoration.errorBackground': opacity(palette.status.error, 0.6),
    'terminalOverviewRuler.cursorForeground': opacity(palette.accent, 0.85),
    'terminalStickyScroll.background': palette.backgroundAlt,
    'terminalStickyScrollHover.background': opacity(palette.accent, lineAlpha),

    'terminal.ansiBlack': ansiColors.normal.black,
    'terminal.ansiRed': ansiColors.normal.red,
    'terminal.ansiGreen': ansiColors.normal.green,
    'terminal.ansiYellow': ansiColors.normal.yellow,
    'terminal.ansiBlue': ansiColors.normal.blue,
    'terminal.ansiMagenta': ansiColors.normal.magenta,
    'terminal.ansiCyan': ansiColors.normal.cyan,
    'terminal.ansiWhite': ansiColors.normal.white,
    'terminal.ansiBrightBlack': ansiColors.bright.black,
    'terminal.ansiBrightRed': ansiColors.bright.red,
    'terminal.ansiBrightGreen': ansiColors.bright.green,
    'terminal.ansiBrightYellow': ansiColors.bright.yellow,
    'terminal.ansiBrightBlue': ansiColors.bright.blue,
    'terminal.ansiBrightMagenta': ansiColors.bright.magenta,
    'terminal.ansiBrightCyan': ansiColors.bright.cyan,
    'terminal.ansiBrightWhite': ansiColors.bright.white,

    'textLink.foreground': palette.accent,
    'textLink.activeForeground': palette.accentHover,
    'textCodeBlock.background': palette.backgroundAlt,
    'textBlockQuote.background': palette.backgroundAlt,
    'textBlockQuote.border': palette.border,
    'textPreformat.foreground': palette.foregroundMuted,

    'breadcrumb.background': palette.background,
    'breadcrumb.foreground': palette.foregroundSubtle,
    'breadcrumb.activeSelectionForeground': palette.foreground,
    'breadcrumb.focusForeground': palette.accent,

    'chat.requestBorder': palette.border,
    'chat.requestBackground': palette.backgroundAlt,
    'chat.requestBubbleBackground': opacity(palette.accent, lineAlpha),
    'chat.slashCommandBackground': opacity(palette.syntax.namespace, lineAlpha),
    'chat.avatarBackground': palette.accent,
    'chat.linesAddedForeground': palette.git.added,
    'chat.linesRemovedForeground': palette.git.deleted,

    'inlineChat.background': palette.surface,
    'inlineChat.border': palette.border,
    'inlineChatInput.background': palette.backgroundAlt,
    'inlineChatInput.border': palette.border,
    'inlineChatDiff.inserted': opacity(palette.status.success, lineAlpha),
    'inlineChatDiff.removed': opacity(palette.status.error, lineAlpha),

    'interactive.activeCodeBorder': palette.accent,
    'interactive.inactiveCodeBorder': palette.border,

    'mergeEditor.change.word.background': opacity(palette.syntax.number, lineAlpha),
    'mergeEditor.conflict.unhandledFocused.border': palette.status.warning,
    'mergeEditor.conflict.input1.background': opacity(palette.status.info, lineAlpha),
    'mergeEditor.conflict.input2.background': opacity(palette.status.warning, lineAlpha),

    'notebook.cellBorderColor': palette.border,
    'notebook.cellHoverBackground': opacity(palette.accent, lineAlpha),
    'notebookStatusSuccessIcon.foreground': palette.status.success,
    'notebookStatusErrorIcon.foreground': palette.status.error,

    'debugToolBar.background': palette.backgroundAlt,
    'debugExceptionWidget.background': opacity(palette.status.error, lineAlpha),
    'debugTokenExpression.name': palette.syntax.variable,

    'testing.runAction': palette.accent,
    'testing.iconFailed': palette.status.error,
    'testing.iconPassed': palette.status.success,
    'testing.iconErrored': palette.status.error,
    'testing.peekBorder': palette.borderStrong,
    'testing.coveredBackground': opacity(palette.status.success, lineAlpha),

    'editorGhostText.foreground': opacity(palette.foregroundMuted, 0.8),
    'editorGhostText.background': transparent,
    'editorInlayHint.foreground': palette.foregroundMuted,
    'editorInlayHint.background': opacity(palette.backgroundMuted, 0.85),
    'editorInlayHint.parameterForeground': palette.syntax.parameter,
    'editorInlayHint.parameterBackground': opacity(palette.syntax.parameter, lineAlpha),
    'editorInlayHint.typeForeground': palette.syntax.type,
    'editorInlayHint.typeBackground': opacity(palette.syntax.type, lineAlpha),
    'editorStickyScroll.background': palette.background,
    'editorStickyScrollHover.background': opacity(palette.accent, lineAlpha),

    'settings.headerForeground': palette.foreground,
    'settings.modifiedItemIndicator': palette.accent,
    'settings.checkboxBackground': palette.surface,
    'settings.checkboxBorder': palette.border,
    'settings.dropdownBackground': palette.surface,
    'settings.dropdownBorder': palette.border,
    'settings.dropdownForeground': palette.foreground,
    'settings.numberInputBackground': palette.surface,
    'settings.numberInputForeground': palette.foreground,
    'settings.numberInputBorder': palette.border,
    'settings.textInputBackground': palette.surface,
    'settings.textInputForeground': palette.foreground,
    'settings.textInputBorder': palette.border,
  };
}
